
---
title: "EDA - Yellow 2023"
output: html_document
---

# General Packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(vegan)
library(ggplot2)
```

# Load Data
```{r}
data<- read.csv("/Users/cmantegna/Documents/GitHub/sicb_km/data/organisms_2023.csv")
```

# Check it out
```{r}
# does it look like it imported correctly? Check your row v column count in the environment window below: X observations (rows) of Y variables (columns).
head(data)

# take a look at your columns, their format, and look for any missing values (NAs), or overall inconsistencies in the data set before doing a deeper dive.
summary(data)

```

# Clean it up
## The current state of it isn't going to work, so we have to do some transformations:
1. Check for empty cells
2. Replace empties with the correct or imputed values
3. Consolidate rows so that there's a cumulative value for each zone in each section (only 3 rows per section)
3. Change the table format so that each section is formatted as a character
4. Change the table orientation so that the rows and columns are swapped; sections as columns and organisms as rows

```{r}

# check for empties
empty_cells <- sum(is.na(data) | data == "")
cat("Number of empty cells:", empty_cells, "\n")

#identify empties. this step is if you have really complicated data and have to manually check each one - we just need to replace empties with 0's.
rows_with_empty <- which(rowSums(is.na(data) | data == "") > 0)
cols_with_empty <- which(colSums(is.na(data) | data == "") > 0)

# replace empties with 0 & then rerun the empty cell step above to double check they were all replaced
data[is.na(data) | data == ""] <- 0
```

## Summarizing Community Composition

```{r summarization}
# Summarize counts by zone
zone_summary <- data %>%
  group_by(ZONATION) %>%
  summarise(across(where(is.numeric), sum, na.rm = TRUE))

# Calculate alpha diversity indices
diversity_metrics <- zone_summary %>%
  mutate(
    richness = rowSums(select(., -ZONATION) > 0),
    shannon = diversity(select(., -ZONATION), index = "shannon"),
    simpson = diversity(select(., -ZONATION), index = "simpson")
  )

print(diversity_metrics)
```

## Beta Diversity and Section Comparisons

```{r beta-diversity}
# Compute Bray-Curtis dissimilarity
bray_dist <- vegdist(select(data, -ZONATION), method = "bray")

# Perform NMDS
nmds <- metaMDS(bray_dist, k = 2)

# Plot NMDS
plot(nmds, type = "t", main = "NMDS of Community Composition")
```

## Zonal Trends

```{r zonal-trends}
# Example: Analyze trends across zones for a selected species
ggplot(data, aes(x = ZONATION, y = `SPECIES_COLUMN`, fill = ZONATION)) +
  geom_boxplot() +
  labs(title = "Species Abundance Across Zones",
       x = "Zonation",
       y = "Abundance") +
  theme_minimal()
```

## Visualization Options

```{r visualizations}
# Stacked bar plot for community composition
zone_long <- zone_summary %>%
  pivot_longer(cols = -ZONATION, names_to = "Species", values_to = "Count")

ggplot(zone_long, aes(x = ZONATION, y = Count, fill = Species)) +
  geom_bar(stat = "identity") +
  labs(title = "Community Composition by Zone",
       x = "Zonation",
       y = "Total Count") +
  theme_minimal()

# Heatmap of abundances
library(pheatmap)
pheatmap(as.matrix(select(zone_summary, -ZONATION)),
         cluster_rows = TRUE, cluster_cols = TRUE,
         main = "Heatmap of Species Abundances")
```

